<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lüleburgaz CBS</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css"/>

<style>
body { margin:0; }
#map { height:100vh; }

.panel{
position:absolute;
top:10px;
left:10px;
background:white;
padding:10px;
z-index:1000;
border-radius:10px;
box-shadow:0 0 10px rgba(0,0,0,0.3);
}

button{
margin:3px;
padding:6px 10px;
border:none;
border-radius:6px;
cursor:pointer;
background:#2c3e50;
color:white;
}

.labelDiv{
text-align:center;
font-size:11px;
font-weight:bold;
color:black;
text-shadow:1px 1px 3px white;
}

/* ÇİZİM ARAÇLARINI AŞAĞI KAYDIR */
.leaflet-top.leaflet-left{
top:120px;
}
</style>
</head>

<body>
<div id="map"></div>

<div class="panel">
<button onclick="gosterNufus()">Nüfus</button>
<button onclick="gosterYas()">Yaş</button>
<button onclick="gosterMedeni()">Medeni</button>
<button onclick="gosterEgitim()">Eğitim</button>
<button onclick="reset()">Temizle</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

<script>

var map = L.map('map').setView([41.402, 27.36], 13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
attribution:'© OpenStreetMap'
}).addTo(map);

var drawControl = new L.Control.Draw({
draw:{
polygon:true,
polyline:true,
rectangle:true,
circle:false,
marker:false
}
});
map.addControl(drawControl);

map.on('draw:created', function (e) {
var layer = e.layer;
map.addLayer(layer);

if(e.layerType === "polygon" || e.layerType === "rectangle"){
var area = L.GeometryUtil.geodesicArea(layer.getLatLngs()[0]);
alert("Alan: " + (area/1000000).toFixed(2) + " km²");
}

if(e.layerType === "polyline"){
var latlngs = layer.getLatLngs();
var total = 0;
for(var i=0;i<latlngs.length-1;i++){
total += latlngs[i].distanceTo(latlngs[i+1]);
}
alert("Uzunluk: " + (total/1000).toFixed(2) + " km");
}
});

/* MAHALLE MERKEZ KOORDİNATLARI */
var mahalleler = [

{name:"8 Kasım",lat:41.4015,lon:27.3587,nufus:10908,yas:"40-44",medeni:"Evli",egitim:"Lise"},
{name:"Atatürk",lat:41.4159,lon:27.3641,nufus:9705,yas:"40-44",medeni:"Evli",egitim:"Lise"},
{name:"Barış",lat:41.4138,lon:27.3695,nufus:4140,yas:"65+",medeni:"Evli",egitim:"İlkokul"},
{name:"Cumhuriyet",lat:41.4146,lon:27.3623,nufus:3644,yas:"65+",medeni:"Evli",egitim:"Lise"},
{name:"Dere",lat:41.4108,lon:27.3668,nufus:1861,yas:"65+",medeni:"Evli",egitim:"Lise"},
{name:"Durak",lat:41.4028,lon:27.3559,nufus:2982,yas:"65+",medeni:"Evli",egitim:"İlkokul"},
{name:"Gençlik",lat:41.4039,lon:27.3604,nufus:6476,yas:"65+",medeni:"Evli",egitim:"Lise"},
{name:"Gündoğu",lat:41.4168,lon:27.3672,nufus:6752,yas:"65+",medeni:"Evli",egitim:"İlkokul"},
{name:"Güneş",lat:41.4081,lon:27.3719,nufus:5927,yas:"65+",medeni:"Evli",egitim:"İlkokul"},
{name:"Hürriyet",lat:41.4012,lon:27.3588,nufus:7331,yas:"65+",medeni:"Evli",egitim:"Lise"},
{name:"İnönü",lat:41.4182,lon:27.3617,nufus:6026,yas:"65+",medeni:"Evli",egitim:"Lise"},
{name:"İstiklal",lat:41.4003,lon:27.3502,nufus:6066,yas:"40-44",medeni:"Evli",egitim:"Lise"},
{name:"Kocasinan",lat:41.4058,lon:27.3517,nufus:6245,yas:"65+",medeni:"Evli",egitim:"Lise"},
{name:"Kurtuluş",lat:41.3979,lon:27.3572,nufus:8056,yas:"65+",medeni:"Evli",egitim:"Lise"},
{name:"Özerler",lat:41.4079,lon:27.3538,nufus:2347,yas:"65+",medeni:"Evli",egitim:"İlkokul"},
{name:"Sarımsaklı",lat:41.4044,lon:27.3562,nufus:17,yas:"0-4",medeni:"Evli",egitim:"Bilinmiyor"},
{name:"Sevgi",lat:41.4049,lon:27.3599,nufus:2101,yas:"65+",medeni:"Evli",egitim:"Lisans"},
{name:"Siteler",lat:41.3962,lon:27.3595,nufus:7679,yas:"65+",medeni:"Evli",egitim:"Lise"},
{name:"Yeni",lat:41.3962,lon:27.3595,nufus:5068,yas:"65+",medeni:"Evli",egitim:"Lise"},
{name:"Yıldırım",lat:41.4175,lon:27.3653,nufus:5519,yas:"20-24",medeni:"Evli",egitim:"Lise"},
{name:"Yıldız",lat:41.3999,lon:27.3650,nufus:8011,yas:"65+",medeni:"Evli",egitim:"Lise"},
{name:"Yılmaz",lat:41.4194,lon:27.3638,nufus:3256,yas:"65+",medeni:"Evli",egitim:"Lise"},
{name:"Zafer",lat:41.3890,lon:27.3657,nufus:7572,yas:"35-39",medeni:"Evli",egitim:"Lisans"}

];

var katmanlar=[];

mahalleler.forEach(function(m){

var circle = L.circleMarker([m.lat,m.lon],{
radius:18,
color:"#222",
fillColor:"#cccccc",
fillOpacity:0.85
}).addTo(map);

var label = L.marker([m.lat,m.lon],{
icon:L.divIcon({
className:'labelDiv',
html:m.name+"<br><span id='val_"+m.name+"'>"+m.nufus+"</span>"
})
}).addTo(map);

circle.veri = m;
circle.labelID = "val_"+m.name;
katmanlar.push(circle);

});

function renkNufus(n){
if(n>9000) return "#800026";
if(n>7000) return "#BD0026";
if(n>5000) return "#E31A1C";
if(n>3000) return "#FC4E2A";
return "#FD8D3C";
}

function gosterNufus(){
katmanlar.forEach(function(k){
k.setStyle({fillColor:renkNufus(k.veri.nufus)});
document.getElementById(k.labelID).innerHTML=k.veri.nufus;
});
}

function gosterYas(){
katmanlar.forEach(function(k){
k.setStyle({fillColor:"#2b8cbe"});
document.getElementById(k.labelID).innerHTML=k.veri.yas;
});
}

function gosterMedeni(){
katmanlar.forEach(function(k){
k.setStyle({fillColor:"#6a0dad"});
document.getElementById(k.labelID).innerHTML=k.veri.medeni;
});
}

function gosterEgitim(){
katmanlar.forEach(function(k){
k.setStyle({fillColor:"#084081"});
document.getElementById(k.labelID).innerHTML=k.veri.egitim;
});
}

function reset(){
katmanlar.forEach(function(k){
k.setStyle({fillColor:"#cccccc"});
document.getElementById(k.labelID).innerHTML=k.veri.nufus;
});
}

</script>
</body>
</html>
